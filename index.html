<!DOCTYPE html>

<html lang="en-us">

<head>

    <meta charset="UTF-8">

    <title>Mind the gap</title>

    <!-- Added Moment JS -->
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">

</head>

<body>
    <div class="container-fluid">
        <div class="row jumbotron" style="background-color:#00a0df; margin: 5px; color:white">
            <div class=" col-md-12">
                <h1 style="text-align:center">Train Schedule</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="card mb-4">
                    <div class="card-body">
                        Train Schedule
                        <table class="table table-sm table-hover" id='train-table'>
                            <thead>
                                <tr>
                                    <th>Train</th>
                                    <th>Destination</th>
                                    <th>Frequency (min)</th>
                                    <th>Next Arrival </th>
                                    <th>Minutes Away</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <hr>
                        <form>
                            <div class="form-group">
                                <label for="formGroupExampleInput">Train Name</label>
                                <input type="text" class="form-control" id="train-name" placeholder="Train Name">
                            </div>
                            <div class="form-group">
                                <label for="formGroupExampleInput2">Destination</label>
                                <input type="text" class="form-control" id="destination" placeholder="Destination">
                            </div>
                            <div class="form-group">
                                <label for="formGroupExampleInput">First Train Time (HH:mm-military time)</label>
                                <input type="text" class="form-control" id="first-train" placeholder="HH:mm">
                            </div>
                            <div class="form-group">
                                <label for="formGroupExampleInput2">Frequency (min)</label>
                                <input type="number" class="form-control" id="frequency" placeholder="00 Minutes">
                            </div>
                            <button type="submit" class="btn btn-primary mb-2 float-right">Submit</button>
                        </form>
                    </div>
                </div>
                <!-- Script -->



                <script src='https://code.jquery.com/jquery-3.3.1.min.js' integrity='sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8='
                    crossorigin='anonymous'></script>


                <script src="https://www.gstatic.com/firebasejs/5.5.4/firebase.js"></script>
                <script>
                    // Assume the following situations.

                    // (TEST 1)
                    // First Train of the Day is 3:00 AM
                    // Assume Train comes every 3 minutes.
                    // Assume the current time is 3:16 AM....
                    // What time would the next train be...? (Use your brain first)
                    // It would be 3:18 -- 2 minutes away

                    // (TEST 2)
                    // First Train of the Day is 3:00 AM
                    // Assume Train comes every 7 minutes.
                    // Assume the current time is 3:16 AM....
                    // What time would the next train be...? (Use your brain first)
                    // It would be 3:21 -- 5 minutes away


                    // ==========================================================

                    // Solved Mathematically
                    // Test case 1:
                    // 16 - 00 = 16
                    // 16 % 3 = 1 (Modulus is the remainder)
                    // 3 - 1 = 2 minutes away
                    // 2 + 3:16 = 3:18

                    // Solved Mathematically
                    // Test case 2:
                    // 16 - 00 = 16
                    // 16 % 7 = 2 (Modulus is the remainder)
                    // 7 - 2 = 5 minutes away
                    // 5 + 3:16 = 3:21

                    // Assumptions

                    // Time is 3:30 AM

                    // First Time (pushed back 1 year to make sure it comes before current time)

                    // Initialize Firebase
                    var config = {
                        apiKey: "AIzaSyCYpjM23ivLhMJ5dQnaPzdYjhVu7En6cX4",
                        authDomain: "train-schedule-a4c97.firebaseapp.com",
                        databaseURL: "https://train-schedule-a4c97.firebaseio.com",
                        projectId: "train-schedule-a4c97",
                        storageBucket: "train-schedule-a4c97.appspot.com",
                        messagingSenderId: "799742551703"
                    };

                    firebase.initializeApp(config);

                    var database = firebase.database();
                    database.ref().on("child_added", function (snapshot) {
                        var trainName = snapshot.val().train;
                        var destination = snapshot.val().destination;
                        var frequency = snapshot.val().frequency;
                        var first = snapshot.val().first;


                        var firstTimeConverted = moment(first, "HH:mm").subtract(1, "years");
                        // console.log(first);
                        // console.log(firstTimeConverted);

                        // Current Time
                        var currentTime = moment();
                        console.log("CURRENT TIME: " + moment(currentTime).format("hh:mm"));
                        ;

                        // Difference between the times
                        var diffTime = moment().diff(moment(firstTimeConverted), "minutes");
                        console.log("DIFFERENCE IN TIME: " + diffTime);

                        // // Time apart (remainder)
                        var tRemainder = diffTime % frequency;
                        console.log(tRemainder);

                        // // Minute Until Train
                        var tMinutesTillTrain = frequency - tRemainder;
                        console.log("MINUTES TILL TRAIN: " + tMinutesTillTrain);

                        // // Next Train
                        var nextTrain = moment().add(tMinutesTillTrain, "minutes");
                        console.log("ARRIVAL TIME: " + moment(nextTrain).format("hh:mm"));
                        console.log(snapshot.val());
                        $("#train-table tbody").append(
                            `
            <tr>
                <td>${trainName}</td>
                <td>${destination}</td>
                <td>${frequency}</td>
                <td>${nextTrain}</td>
                <td>${tMinutesTillTrain}</td>
            </tr>
        `
                        );
                    });
                    $("button").on("click", function (event) {
                        event.preventDefault();
                        var trainName = $("#train-name").val();
                        var destination = $("#destination").val();
                        var frequency = $("#frequency").val();
                        var first = $("#first-train").val();

                        database.ref().push({
                            train: trainName,
                            destination: destination,
                            frequency: frequency,
                            first: first
                        });
                        $("#train-table tbody").append(
                            `
            <tr>
                <td>${trainName}</td>
                <td>${destination}</td>
                <td>${frequency}</td>
                <td></td>
                <td></td>
            </tr>
        `
                        );
                    });   
                </script>
</body>

</html>